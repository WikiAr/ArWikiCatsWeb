# Overview

> **Relevant source files**
> * [README.md](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md)
> * [src/app.py](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py)

## Purpose and Scope

This document provides a high-level introduction to ArWikiCatsWeb, an Arabic Wikipedia category label resolution service. It describes the system's purpose, core components, and architecture.

For detailed information about specific subsystems, see:

* Installation and local development: [Getting Started](/ArWikiCats/ArWikiCatsWeb/2-getting-started)
* Detailed architectural patterns: [Architecture](/ArWikiCats/ArWikiCatsWeb/3-architecture)
* REST API documentation: [REST API](/ArWikiCats/ArWikiCatsWeb/4-rest-api)
* Web interface details: [Web Interface](/ArWikiCats/ArWikiCatsWeb/5-web-interface)
* Logging infrastructure: [Logging System](/ArWikiCats/ArWikiCatsWeb/6-logging-system)
* Database operations: [Database Layer](/ArWikiCats/ArWikiCatsWeb/7-database-layer)
* Production deployment: [Deployment](/ArWikiCats/ArWikiCatsWeb/8-deployment)
* Testing strategy: [Testing](/ArWikiCats/ArWikiCatsWeb/9-testing)

Sources: [README.md L1-L271](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L1-L271)

## System Purpose

ArWikiCatsWeb is a Flask-based web service that resolves Arabic Wikipedia category labels by translating English category names to their Arabic equivalents. The system serves two primary user types:

1. **Wikipedia bots and automated tools** via a REST API that requires User-Agent header validation
2. **Human users** via a web interface for interactive category lookup and batch processing

The service integrates with the **ArWikiCats** library, which provides the core category resolution logic. All requests are logged to a SQLite database for usage tracking, analytics, and debugging.

Sources: [README.md L1-L18](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L1-L18)

 [README.md L245-L252](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L245-L252)

## Core Components

The application follows Flask's application factory pattern with clear separation of concerns:

| Component | File Path | Purpose |
| --- | --- | --- |
| **WSGI Entry Point** | [src/app.py L1-L16](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L1-L16) | Production entry point using `create_app()` factory |
| **Development Entry Point** | `src/app1.py` | Alternative entry point for development |
| **Application Factory** | `src/app/__init__.py` | `create_app()` function that initializes Flask app |
| **API Blueprint** | `src/app/routes/api.py` | REST API endpoints for category resolution and log retrieval |
| **UI Blueprint** | `src/app/routes/ui.py` | Web interface routes |
| **Logs Bot** | `src/app/logs_bot.py` | Business logic for log retrieval and filtering (100% test coverage) |
| **Logs DB Module** | `src/app/logs_db/` | Database abstraction layer (`bot.py`, `db.py`) |
| **Templates** | `src/templates/` | Jinja2 HTML templates using template inheritance |
| **Static Assets** | `src/static/` | JavaScript, CSS, and theme files |

Sources: [README.md L73-L108](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L73-L108)

 [src/app.py L1-L16](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L1-L16)

 [README.md L236-L240](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L236-L240)

## System Architecture

The following diagram maps the system's major components to their concrete implementations in the codebase:

```mermaid
flowchart TD

WikipediaBots["Wikipedia Bots<br>(require User-Agent header)"]
WebBrowsers["Web Browsers<br>(ar.wikipedia.org via CORS)"]
app_py["src/app.py<br>(WSGI production)"]
app1_py["src/app1.py<br>(development)"]
create_app["create_app()<br>src/app/__init__.py"]
init_db["init_db()<br>src/app/logs_db"]
api_blueprint["API Blueprint<br>src/app/routes/api.py<br>(100% coverage)"]
ui_blueprint["UI Blueprint<br>src/app/routes/ui.py<br>(100% coverage)"]
logs_bot["logs_bot module<br>src/app/logs_bot.py<br>(100% coverage)"]
ArWikiCats["ArWikiCats library<br>(external dependency)"]
logs_db_bot["logs_db.bot<br>src/app/logs_db/bot.py"]
logs_db_core["logs_db.db<br>src/app/logs_db/db.py"]
sqlite["api_logs.db<br>(SQLite database)"]
templates["Jinja2 Templates<br>src/templates/"]
static["Static Assets<br>src/static/"]

WikipediaBots --> api_blueprint
WebBrowsers --> ui_blueprint
app_py --> create_app
app1_py --> create_app
create_app --> api_blueprint
create_app --> ui_blueprint
api_blueprint --> logs_bot
api_blueprint --> ArWikiCats
ui_blueprint --> logs_bot
ui_blueprint --> templates
ui_blueprint --> static
logs_bot --> logs_db_bot
api_blueprint --> logs_db_bot
static --> api_blueprint

subgraph presentation ["Presentation Layer"]
    templates
    static
end

subgraph data ["Data Layer"]
    logs_db_bot
    logs_db_core
    sqlite
    logs_db_bot --> logs_db_core
    logs_db_core --> sqlite
end

subgraph business ["Business Logic"]
    logs_bot
    ArWikiCats
end

subgraph routes ["Route Handlers"]
    api_blueprint
    ui_blueprint
end

subgraph core ["Application Core"]
    create_app
    init_db
    create_app --> init_db
end

subgraph entry ["Entry Points"]
    app_py
    app1_py
end

subgraph clients ["External Clients"]
    WikipediaBots
    WebBrowsers
end
```

**Component Relationships:**

* Both entry points ([src/app.py L10](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L10-L10)  `src/app1.py`) invoke `create_app()` to instantiate the Flask application
* `create_app()` registers two blueprints: `api_blueprint` and `ui_blueprint`
* The API blueprint depends on both `logs_bot` for log retrieval and `ArWikiCats` for category resolution
* The UI blueprint serves templates that include static assets; these assets make client-side calls back to the API
* All data persistence flows through `logs_db.bot` → `logs_db.db` → SQLite
* `init_db()` is called on application startup to ensure database schema exists

Sources: [src/app.py L1-L16](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L1-L16)

 [README.md L73-L108](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L73-L108)

 [README.md L236-L240](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L236-L240)

## Request Processing Flow

The system handles two distinct request patterns:

### API Request Flow

```mermaid
sequenceDiagram
  participant Wikipedia Bot
  participant api_blueprint
  participant src/app/routes/api.py
  participant ArWikiCats
  participant library
  participant logs_bot
  participant src/app/logs_bot.py
  participant logs_db
  participant bot.py + db.py
  participant api_logs.db

  Wikipedia Bot->>api_blueprint: GET /api/Category:Yemen
  api_blueprint->>api_blueprint: check_user_agent() (User-Agent header required)
  api_blueprint->>ArWikiCats: Resolve English to Arabic label
  ArWikiCats-->>api_blueprint: "تصنيف:اليمن"
  api_blueprint->>logs_db: log_request()
  logs_db->>api_logs.db: log_request(endpoint, title, result, status)
  api_logs.db-->>logs_db: INSERT INTO logs
  api_blueprint-->>Wikipedia Bot: log_id
```

### Web UI Request Flow

```mermaid
sequenceDiagram
  participant Web Browser
  participant ui_blueprint
  participant src/app/routes/ui.py
  participant Jinja2
  participant src/templates/
  participant Client JS
  participant src/static/js/
  participant api_blueprint

  Web Browser->>ui_blueprint: GET /
  ui_blueprint->>Jinja2: render_template('index.html')
  Jinja2-->>ui_blueprint: HTML with static asset references
  ui_blueprint-->>Web Browser: HTML page
  Web Browser->>Client JS: Load api.js, autocomplete.js
  Client JS-->>Web Browser: JavaScript loaded
  Web Browser->>api_blueprint: fetch('/api/Category:Example')
  api_blueprint-->>Web Browser: (client-side call)
  Client JS->>Web Browser: JSON response
```

**Key Differences:**

1. **API requests** require a `User-Agent` header; validation occurs in the blueprint before processing
2. **UI requests** return server-rendered HTML that subsequently makes client-side API calls
3. **Logging** occurs on API requests, capturing the endpoint, input title, resolved result, and response status
4. **ArWikiCats integration** is invoked directly by API endpoints, not by UI routes

Sources: [README.md L110-L169](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L110-L169)

 [README.md L179-L193](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L179-L193)

## Major Subsystems

### REST API (detailed documentation)

The API blueprint provides endpoints for:

* **Single category resolution**: `GET /api/<title>`
* **Batch processing**: `POST /api/list` with JSON body
* **Log retrieval**: Multiple endpoints for querying logs with filtering, pagination, and date aggregation
* **User-Agent validation**: All API requests must include a valid `User-Agent` header

See [REST API](/ArWikiCats/ArWikiCatsWeb/4-rest-api) for complete endpoint documentation.

Sources: [README.md L110-L169](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L110-L169)

### Web Interface (detailed documentation)

The UI provides interactive pages built with Jinja2 templates:

* **Category lookup**: `/` for single category, `/list` for batch processing
* **Log viewing**: `/logs` with pagination, `/logs_by_day` with date grouping
* **Visualizations**: `/chart` for statistics with Chart.js integration
* **Template inheritance**: Base template (`main.html`) provides Bootstrap, jQuery, DataTables, Font Awesome

See [Web Interface](/ArWikiCats/ArWikiCatsWeb/5-web-interface) for UI components and client-side JavaScript.

Sources: [README.md L170-L177](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L170-L177)

### Logging System (detailed documentation)

The logging infrastructure consists of:

* **Two-table schema**: `logs` table for general API requests, `list_logs` table for batch endpoints
* **Two-layer abstraction**: `logs_db.db` for raw SQL operations, `logs_bot` for business logic
* **Comprehensive tracking**: All API requests are logged with title, result, status, timestamp, User-Agent
* **Analysis functions**: `logs_bot` provides functions for filtering, pagination, date aggregation, and status categorization

See [Logging System](/ArWikiCats/ArWikiCatsWeb/6-logging-system) for schema details and querying patterns.

Sources: [README.md L159-L169](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L159-L169)

 [README.md L245-L252](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L245-L252)

### Database Layer (detailed documentation)

The `logs_db` module provides database operations:

* **`logs_db.db`**: Core functions like `fetch_all()`, `db_commit()`, `init_db()`
* **`logs_db.bot`**: Higher-level functions like `log_request()`, `get_all_logs()`
* **SQLite storage**: Single `api_logs.db` file with two tables
* **Schema initialization**: `init_db()` called on app startup ([src/app.py L13](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L13-L13) )

See [Database Layer](/ArWikiCats/ArWikiCatsWeb/7-database-layer) for operation details.

Sources: [src/app.py L8-L15](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/src/app.py#L8-L15)

 [README.md L80-L85](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L80-L85)

## Deployment Architecture

### Toolforge Kubernetes Deployment

The service runs on Wikimedia Toolforge with the following configuration:

| Resource | Value |
| --- | --- |
| **Backend** | Kubernetes |
| **Python Version** | 3.11 |
| **CPU Allocation** | 3 cores |
| **Memory Allocation** | 6Gi |
| **Replicas** | 2 (high availability) |
| **Web Server** | UWSGI |

Configuration is defined in `service.template`.

### CI/CD Pipeline

```mermaid
flowchart TD

Developer["Developer"]
GitHub["GitHub Repository"]
PytestWorkflow["pytest.yml workflow<br>(run tests)"]
Codecov["Codecov<br>(89% coverage)"]
UpdateWorkflow["update.yml workflow<br>(auto-deploy)"]
Scripts["Deployment Scripts<br>update1.sh, pip.sh, web_venv.sh"]
Toolforge["Toolforge K8s<br>(2 replicas)"]

Developer --> GitHub
GitHub --> PytestWorkflow
PytestWorkflow --> Codecov
GitHub --> UpdateWorkflow
UpdateWorkflow --> Scripts
Scripts --> Toolforge
```

* **Quality gates**: Tests run automatically on pull requests
* **Automated deployment**: Pushes to `main` branch trigger deployment to Toolforge
* **Test coverage**: 89% overall, 100% on critical modules (`api.py`, `ui.py`, `logs_bot.py`)

See [Deployment](/ArWikiCats/ArWikiCatsWeb/8-deployment) for deployment scripts and [Testing](/ArWikiCats/ArWikiCatsWeb/9-testing) for test infrastructure.

Sources: [README.md L196-L214](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L196-L214)

 [README.md L217-L244](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L217-L244)

## Technology Stack

| Layer | Technologies |
| --- | --- |
| **Backend** | Flask (application factory pattern), Flask-CORS |
| **External Library** | ArWikiCats (category resolution) |
| **Database** | SQLite 3 |
| **Frontend** | Bootstrap 5.3.0, jQuery 3.7.0, DataTables 2.2.2, Font Awesome 6.7.2, Chart.js |
| **Testing** | pytest, pytest-cov, unittest.mock |
| **Deployment** | Kubernetes, UWSGI |
| **CI/CD** | GitHub Actions |

Sources: [README.md L19-L26](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L19-L26)

 [README.md L245-L252](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L245-L252)

## Project File Structure

```markdown
ArWikiCatsWeb/
├── src/
│   ├── app/
│   │   ├── __init__.py          # create_app() factory
│   │   ├── logs_bot.py          # Log retrieval business logic
│   │   ├── logs_db/             # Database abstraction
│   │   │   ├── bot.py           # Higher-level DB operations
│   │   │   └── db.py            # Core SQL operations
│   │   └── routes/
│   │       ├── api.py           # API endpoints
│   │       └── ui.py            # Web UI routes
│   ├── templates/               # Jinja2 templates
│   ├── static/                  # JS, CSS assets
│   ├── app.py                  # WSGI entry point
│   └── app1.py                 # Development entry point
├── tests/                       # Test suite (89% coverage)
├── .github/workflows/           # CI/CD workflows
├── service.template            # Toolforge K8s config
└── requirements.txt            # Python dependencies
```

Sources: [README.md L73-L108](https://github.com/ArWikiCats/ArWikiCatsWeb/blob/88f42d13/README.md#L73-L108)